<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>管理员控制台 - 朵拉的热带探险</title>
    <link rel="stylesheet" href="/static/css/admin.css">
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <div class="sidebar-header">
                <h2>Prolog Sessions</h2>
                <div style="font-size: 11px; color: #8b949e;">管理员完整访问</div>
            </div>

            <!-- 模式切换 -->
            <div class="mode-switch">
                <button id="shellModeBtn" class="mode-btn active" onclick="switchMode('shell')">Shell模式</button>
                <button id="guiModeBtn" class="mode-btn" onclick="switchMode('gui')">GUI模式</button>
            </div>

            <button class="new-session-btn" onclick="createNewSession()">+ 创建新会话</button>
            <div class="session-list" id="sessionList">
                <div style="padding: 20px; color: #8b949e; text-align: center;">加载中...</div>
            </div>
        </div>

        <div class="main-content">
            <!-- Shell模式界面 -->
            <div id="shellArea" style="display: none; flex: 1; flex-direction: column;">
                <div class="toolbar">
                    <div class="session-info" id="currentSessionInfo">未选择会话</div>
                    <button onclick="refreshOutput()">刷新输出</button>
                    <button onclick="clearOutput()">清空显示</button>
                    <button class="danger" onclick="killSession()">终止会话</button>
                </div>

                <div class="quick-queries">
                    <label>快捷查询:</label>
                    <button onclick="quickQuery('listing(player_location/1).')">玩家位置</button>
                    <button onclick="quickQuery('listing(swiper_location/1).')">Swiper位置</button>
                    <button onclick="quickQuery('player_backpack(L), write(L), nl.')">背包物品</button>
                    <button onclick="quickQuery('findall((R,I), room_has_item(R,I), L), write(L), nl.')">场景物品</button>
                    <button onclick="quickQuery('findall((L,I), swiper_hidden_item(L,I), R), write(R), nl.')">藏匿物品</button>
                    <button onclick="quickQuery('player_score(S), game_time(T), format(\"Score: ~w, Time: ~w\", [S,T]).')">得分/时间</button>
                    <button onclick="quickQuery('listing.')">完整listing</button>
                </div>

                <div class="shell-container">
                    <div class="shell-output" id="shellOutput">
                        <span class="system">选择一个会话开始...</span>
                    </div>

                    <div class="shell-input-area">
                        <span class="prompt-label">?-</span>
                        <input type="text" id="shellInput" placeholder="输入Prolog命令..."
                               onkeydown="handleShellKeyDown(event)" autocomplete="off">
                        <button onclick="sendShellCommand()">执行</button>
                    </div>
                </div>
            </div>

            <!-- GUI模式界面 -->
            <div id="guiArea" style="display: none; flex: 1; flex-direction: column;">
                <div class="toolbar">
                    <div class="session-info" id="guiSessionInfo">未选择会话</div>
                    <button onclick="guiRefresh()">刷新状态</button>
                    <button onclick="clearGuiOutput()">清空输出</button>
                    <button class="danger" onclick="killSession()">终止会话</button>
                </div>

                <div class="gui-container">
                    <!-- 状态面板 -->
                    <div class="gui-status-panel">
                        <div class="status-card">
                            <h4>玩家状态</h4>
                            <div id="guiPlayerLocation">位置: -</div>
                            <div id="guiPlayerScore">得分: -</div>
                            <div id="guiGameTime">时间: -</div>
                        </div>
                        <div class="status-card swiper-card">
                            <h4>Swiper状态</h4>
                            <div id="guiSwiperLocation">位置: -</div>
                            <div id="guiSwiperCarrying">携带: -</div>
                            <div id="guiSwiperStatus">状态: 活跃</div>
                        </div>
                        <div class="status-card">
                            <h4>背包</h4>
                            <div id="guiBackpack">空</div>
                        </div>
                        <div class="status-card">
                            <h4>藏匿物品</h4>
                            <div id="guiHiddenItems">无</div>
                        </div>
                    </div>

                    <!-- 游戏输出 -->
                    <div class="gui-output" id="guiOutput">
                        <span class="system">选择一个会话开始游戏...</span>
                    </div>

                    <!-- 游戏命令 -->
                    <div class="gui-commands">
                        <div class="command-group">
                            <label>移动:</label>
                            <button onclick="guiCommand('go(north)')">北</button>
                            <button onclick="guiCommand('go(south)')">南</button>
                            <button onclick="guiCommand('go(east)')">东</button>
                            <button onclick="guiCommand('go(west)')">西</button>
                        </div>
                        <div class="command-group">
                            <label>动作:</label>
                            <button onclick="guiCommand('look')">查看</button>
                            <button onclick="guiCommand('inventory')">背包</button>
                            <button onclick="guiCommand('status')">状态</button>
                            <button onclick="guiCommand('boots_search')">Boots搜索</button>
                            <button onclick="guiCommand('stop_swiper')">阻止Swiper</button>
                        </div>
                        <div class="command-group">
                            <label>物品:</label>
                            <input type="text" id="guiItemInput" placeholder="物品名..." style="width: 120px;">
                            <button onclick="guiTakeItem()">拾取</button>
                            <button onclick="guiDropItem()">丢弃</button>
                            <button onclick="guiUseItem()">使用</button>
                        </div>
                    </div>

                    <!-- 自定义命令 -->
                    <div class="gui-custom-command">
                        <input type="text" id="guiCustomInput" placeholder="输入游戏命令..."
                               onkeydown="handleGuiKeyDown(event)">
                        <button onclick="sendGuiCommand()">发送</button>
                    </div>
                </div>
            </div>

            <!-- 无会话提示 -->
            <div id="noSessionArea" class="no-session">
                <div style="text-align: center;">
                    <div style="font-size: 48px; margin-bottom: 20px;">$_</div>
                    <div>选择左侧会话或创建新会话</div>
                    <div style="margin-top: 10px; font-size: 12px;">管理员可执行任意Prolog命令</div>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/js/admin.js"></script>
</body>
</html>
